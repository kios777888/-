# ============================================================================
# requirements.txt - Production dependencies
# ============================================================================
Flask==3.0.0
Flask-CORS==4.0.0
Flask-SQLAlchemy==3.1.1
Flask-SocketIO==5.3.5
python-socketio==5.10.0
python-engineio==4.8.0
python-dotenv==1.0.0
PyJWT==2.8.1
Werkzeug==3.0.1
gunicorn==21.2.0
SQLAlchemy==2.0.23
pydantic==2.5.0

# ============================================================================
# SETUP & RUN INSTRUCTIONS
# ============================================================================

# 1. CREATE VIRTUAL ENVIRONMENT
python3 -m venv venv

# 2. ACTIVATE VIRTUAL ENVIRONMENT
# On Windows (PowerShell):
venv\Scripts\Activate.ps1

# On macOS/Linux:
source venv/bin/activate

# 3. INSTALL DEPENDENCIES
pip install --upgrade pip
pip install -r requirements.txt

# 4. CREATE .env FILE (OPTIONAL - for production config)
cat > .env << 'EOF'
FLASK_ENV=development
SECRET_KEY=your-secret-key-here-change-in-production
DATABASE_URL=sqlite:///mafia.db
PORT=5000
EOF

# 5. INITIALIZE DATABASE
python3 << 'EOF'
from app import app, db
with app.app_context():
    db.create_all()
    print("✓ Database initialized")
EOF

# 6. RUN DEVELOPMENT SERVER
python3 app.py
# Server runs at: http://localhost:5000 or http://192.168.x.x:5000

# 7. FOR PRODUCTION (using gunicorn)
gunicorn --worker-class eventlet -w 1 --bind 0.0.0.0:5000 --timeout 300 app:app

# ============================================================================
# PROJECT STRUCTURE
# ============================================================================
shkon-l-mafia/
├── app.py                          # Main Flask app with Socket.IO
├── requirements.txt                # Python dependencies
├── .env                            # Environment variables (create if needed)
├── mafia.db                        # SQLite database (auto-created)
├── templates/
│   ├── index.html                 # Main game UI
│   ├── print.html                 # A4 printable sheet
│   └── [login.html, register.html] # (integrated into index.html)
├── static/
│   ├── style.css                  # (optional, inlined in index.html)
│   └── logo.png                   # (optional brand asset)
└── venv/                          # Virtual environment

# ============================================================================
# TESTING CHECKLIST
# ============================================================================

# TEST 1: Server is running
curl http://localhost:5000/health
# Expected: {"status":"ok"}

# TEST 2: Create account
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","email":"test@example.com","password":"password123"}'
# Expected: 201 with token and user object

# TEST 3: Login
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
# Expected: 200 with token

# TEST 4: Create room
curl -X POST http://localhost:5000/api/rooms \
  -H "Content-Type: application/json" \
  -d '{"name":"Test Room","max_players":8}'
# Expected: 201 with room object and id

# TEST 5: List rooms
curl http://localhost:5000/api/rooms
# Expected: 200 with array of room objects

# TEST 6: Get room details
curl http://localhost:5000/api/rooms/{ROOM_ID}
# Expected: 200 with room details, players, gameState

# TEST 7: Print sheet
curl http://localhost:5000/print
# Expected: 200 HTML page (open in browser or save as PDF)

# TEST 8: Leaderboard
curl http://localhost:5000/api/leaderboard?limit=10
# Expected: 200 with top players sorted by wins

# TEST 9: Socket.IO connection (in browser console)
# Open http://localhost:5000
# Play > Guest login
# Create or join room
# Check browser console for: "✓ Connected, SID: [socket_id]"
# Join room as 2 clients
# Start game → Both should receive role assignments
# Night phase → Mafia/Doctor/Detective can choose actions
# Day phase → All players can vote

# TEST 10: Game flow
# 1. Create room with 4+ players
# 2. Click "Start"
# 3. Each gets private role notification
# 4. Night: Mafia kills → Doctor heals → Detective investigates
# 5. Morning: Result shown
# 6. Day: All vote to eliminate
# 7. Repeat until Mafia or Villagers win
# 8. Final result screen shown

# ============================================================================
# ENVIRONMENT VARIABLES (for production)
# ============================================================================
FLASK_ENV=production              # Set to 'production' to disable debug
SECRET_KEY=<generate-random>      # Use: python -c "import secrets; print(secrets.token_hex(32))"
DATABASE_URL=sqlite:///mafia.db   # or postgresql://user:pass@host/db
PORT=5000                         # Port to run on
